======================================================================
  RTComponent: PresentationLPInterface specificatioin

  OpenRTM-aist-1.0.0
  Date: $Date$

  @author 佐々木毅 (Takeshi SASAKI)
   sasaki-t(_at_)ieee.org

  This file is generated by rtc-template with the following argments.

#   rtc-template -bcxx --module-name=PresentationLPInterface 
#   --module-desc='Create slide change and draw commands for presentation component based on laser light pointing' --module-version=1.0.0 --module-vendor=TakeshiSasaki 
#   --module-category=Presentation --module-comp-type=COMMUTATIVE 
#   --module-act-type=PERIODIC --module-max-inst=0 
#   --config=DetectLuminanceDiff:int:30 --config=DetectBgUpdate:int:5 --config=DetectUpdateTime:double:0.5 --config=ScreenZ:double:0.0 --config=SlideChangeArea:string:top --config=SlideChangeAreaSize:int:50 --config=SlideChangeCount:int:5 --config=SlideChangeWait:double:1.0 
#   --inport=Image:Img::TimedCameraImage --inport=BgUpdateTrigger:RTC::TimedShort --outport=SlideRelativeCommand:RTC::TimedShort --outport=DrawPositions:RTC::TimedShortSeq 
#   --consumer-idl=C:\Users\ssklab\workspace\idl\SlideSize.idl 
#   --consumer=SlideSizeInfoPort:SlideSizeInfo:Slide::SlideSizeInfo 


======================================================================
    Basic Information
======================================================================
# <rtc-template block="module">
Module Name: PresentationLPInterface
Description: Create slide change and draw commands for presentation component based on laser light pointing
Version:     1.0.0
Vendor:      TakeshiSasaki
Category:    Presentation
Kind:        DataFlowComponent
Comp. Type:  COMMUTATIVE
Act. Type:   PERIODIC
MAX Inst.:   0
Lang:        C++
Lang Type:   

Overview:    カメラコンポーネントと併用することで、レーザポインタに
             よるスライドページの変更とスライド内への描画を行う。た
             だし、カメラはスライドを表示しているスクリーンやディス
             プレイをz=c（一定）の平面とし、表示されているスライド
             の左上を(0,0,c)、右下を(slide_width,slide_height,c)と
             してキャリブレーションされているものとする。InPortのI
             mageから読み込んだ画像から、輝度が閾値以上大きくなった
             点を検出候補点とし、最も明るく変化した点をレーザポイン
             タで指されたスライド上の位置を認識する。さらに、その位
             置に応じてプレゼンテーションコンポーネントのスライドペ
             ージ変更コマンドとペン描画位置に対応する数値をOutPort
             のSlideRelativeCommandとDrawPositionsからそれぞれ出力
             する。
In/Out:      InPort
             ポート名/型/説明
             Image/TimedCameraImage/入力画像及び座標変換のためのカ
             メラパラメータ。
             BgUpdateTrigger/TimedShort/何かデータが入力された場合
             、背景画像を更新する。
             OutPort
             ポート名/型/説明
             SlideRelativeCommand/TimedShort/スライドのページを変更
             するためのコマンドに対応する数値。
             DrawPositions/TimedShortSeq/ペンで描画する位置に対応す
             る数値。
             ServicePort
             ポート名:SlideSizeInfoPort
             インタフェース名/方向/説明
             SlideSizeInfo/Required/スライドの画像の幅と高さを取得
             するためのインタフェース。
# </rtc-template>


======================================================================
    Activity definition
======================================================================

[on_initialize]    implemented

[on_finalize]

[on_startup]

[on_shutdown]

[on_activated]     implemented
	Description:   初期化を行う。

[on_deactivated]

[on_execute]       implemented
	Description:   InPortのImageから読み込んだ画像から、スライド上の
	               レーザポインタで指された位置を認識し、その位置に応
	               じてプレゼンテーションコンポーネントのスライドペー
	               ジ変更コマンドとペン描画位置に対応する数値をOutPo
	               rtのSlideRelativeCommandとDrawPositionsからそれぞ
	               れ出力する。

[on_aborting]

[on_error]

[on_reset]

[on_state_update]

[on_rate_changed]

======================================================================
    InPorts definition
======================================================================
# <rtc-template block="inport">

	Name:        Image
	PortNumber:  0
	Description: 入力画像及び座標変換のためのカメラパラメータ。
	PortType: 
	DataType:    Img::TimedCameraImage
	MaxOut: 
	[Data Elements]
		Name:
		Type:            TimedCameraImage
		Number:          1
		Semantics:       
		Unit:            
		Frequency:       
		Operation Cycle: 
		RangeLow:
		RangeHigh:
		DefaultValue:

	Name:        BgUpdateTrigger
	PortNumber:  1
	Description: 何かデータが入力された場合、背景画像を更新する。
	PortType: 
	DataType:    RTC::TimedShort
	MaxOut: 
	[Data Elements]
		Name:
		Type:            TimedShort
		Number:          1
		Semantics:       
		Unit:            
		Frequency:       
		Operation Cycle: 
		RangeLow:
		RangeHigh:
		DefaultValue:


# </rtc-template>

======================================================================
    OutPorts definition
======================================================================
# <rtc-template block="outport">

	Name:        SlideRelativeCommand
	PortNumber:  0
	Description: スライドのページを変更するためのコマンドに対応する数
	             値。コンフィギュレーションのSlideChangeAreaとSlideC
	             hangeAreaSizeで指定された領域にSlideChangeCount回以
	             上点が検出された場合に、SlideChangeArea内の位置に応
	             じて-1,0,1のいずれかを出力する。
	PortType: 
	DataType:    RTC::TimedShort
	MaxOut: 
	[Data Elements]
		Name:
		Type:            TimedShort
		Number:          1
		Semantics:       
		Unit:            
		Frequency:       
		Operation Cycle: 
		RangeLow:
		RangeHigh:
		DefaultValue:

	Name:        DrawPositions
	PortNumber:  1
	Description: 検出された点の中で最も輝度の差が高い点の位置(x,y)。
	             コンフィギュレーションのDetectUpdateTime以内に新たに
	             点が検出された場合は移動を続けているものと考え、1ス
	             テップ前の位置と現在の位置(x_old, y_old, x_now,
	             y_now)の2点を出力する。
	PortType: 
	DataType:    RTC::TimedShortSeq
	MaxOut: 
	[Data Elements]
		Name:
		Type:            TimedShortSeq
		Number:          2または4
		Semantics:       
		Unit:            
		Frequency:       
		Operation Cycle: 
		RangeLow:
		RangeHigh:
		DefaultValue:


# </rtc-template>


======================================================================
    Service Port definition
======================================================================
# <rtc-template block="serviceport">
	PortName:    SlideSizeInfoPort
	Description: 
	Interface:   
		[Service Consumer Interfaces]
		Name:          SlideSizeInfo
		Type:          Slide::SlideSizeInfo
		Description:   スライドの画像の幅と高さを取得するためのインタフ
		               ェース。
		               short getWidth(); //スライドの画像の幅を取得
		               short getHeight();
		               //スライドの画像の高さを取得
		Argument:      
		Return Value:  
		Exception:     
		PreCondition:  
		PostCondition: 
# </rtc-template> 

======================================================================
    Configuration definition
======================================================================
# <rtc-template block="configuration">
	Configuration:
		Name:            DetectLuminanceDiff DetectLuminanceDiff
		Description:     入力画像のある点の輝度が背景画像のその点の輝度
		                 よりもこの値以上大きい場合、検出の候補点となる
		                 。
		Type:            int
		DefaultValue:    30 30
		Unit:            
		Range:           
		Constraint:      

		Name:            DetectBgUpdate DetectBgUpdate
		Description:     閾値処理で得られた候補点の数がこの値以上の場合
		                 、背景は大きく変化してしまっているものと考え、
		                 背景を更新する。ただし、この値が負の場合は、何
		                 点検出されても背景を更新しない。
		Type:            int
		DefaultValue:    5 5
		Unit:            
		Range:           
		Constraint:      

		Name:            DetectUpdateTime DetectUpdateTime
		Description:     最新の検出から次の検出までの時間がこの値以下の
		                 場合、2つの点は連続したものとして考える。
		                 （毎ステップ確実に検出できるとは限らないため、
		                 プレゼンテーションコンポーネントで線を描画した
		                 場合に途切れ途切れになることを避ける等の目的で
		                 使用。）
		Type:            double
		DefaultValue:    0.5 0.5
		Unit:            sec
		Range:           
		Constraint:      x>=0

		Name:            ScreenZ ScreenZ
		Description:     スクリーン平面のz座標。スクリーンをz=(一定)の
		                 平面と考え、単眼カメラで位置を出すために使用。
		Type:            double
		DefaultValue:    0.0 0.0
		Unit:            
		Range:           
		Constraint:      

		Name:            SlideChangeArea SlideChangeArea
		Description:     スライドのページを変更するためのコマンドを生成
		                 する領域を定義する。この値がtopの場合は画像の
		                 上端、leftの場合は画像の左端、rightの場合は画
		                 像の右端、bottomの場合は画像の下端を基準とし、
		                 コンフィギュレーションのSlideChangeAreaSizeで
		                 指定された範囲までの領域（例えば、SlideChange
		                 Areaがtop、SlideChangeAreaSizeが10なら画像の上
		                 端から10画素の範囲、つまり10×画像幅の矩形領域
		                 ）を範囲とする。
		Type:            string
		DefaultValue:    top top
		Unit:            
		Range:           
		Constraint:      (top,left,right,bottom)

		Name:            SlideChangeAreaSize SlideChangeAreaSize
		Description:     スライドのページを変更するためのコマンドを生成
		                 する領域を定義する。コンフィギュレーションのS
		                 lideChangeAreaがtopの場合は画像の上端、leftの
		                 場合は画像の左端、rightの場合は画像の右端、bo
		                 ttomの場合は画像の下端を基準とし、この値で指定
		                 された範囲までの領域（例えば、SlideChangeArea
		                 がtop、SlideChangeAreaSizeが10なら画像の上端か
		                 ら10画素の範囲、つまり10×画像幅の矩形領域）を
		                 範囲とする。
		Type:            int
		DefaultValue:    50 50
		Unit:            pixel
		Range:           
		Constraint:      x>0

		Name:            SlideChangeCount SlideChangeCount
		Description:     コンフィギュレーションのSlideChangeAreaとSlid
		                 eChangeAreaSizeで指定された領域のある部分でSl
		                 ideChangeCount回以上連続して点が検出された場合
		                 に、スライドを変更するコマンドを生成する。
		                 命令の種類は、領域の左側1/3（SlideChangeAreaが
		                 topまたはbottomのとき）または上側1/3（leftまた
		                 はrightのとき）で検出された場合は前のスライド
		                 へ戻すコマンド(=-1)、中央1/3で検出された場合は
		                 スライドの現在のページを再読み込みするコマンド
		                 (=0)、右側1/3（SlideChangeAreaがtopまたはbott
		                 omのとき）または下側1/3（leftまたはrightのとき
		                 ）で検出された場合はスライドを次のページへ進め
		                 るコマンド(=1)とする。
		Type:            int
		DefaultValue:    5 5
		Unit:            
		Range:           
		Constraint:      x>0

		Name:            SlideChangeWait SlideChangeWait
		Description:     このコンポーネントによってスライドが変更された
		                 とき、この時間だけ何もせずに待つ。
		                 （スライドの変更が連続して起こったり、スライド
		                 変更直後の不要な描画を避けるため。）
		Type:            double
		DefaultValue:    1.0 1.0
		Unit:            sec
		Range:           
		Constraint:      x>=0

# </rtc-template> 

This software is developed at the National Institute of Advanced
Industrial Science and Technology. Approval number H23PRO-????. This
software is licensed under the Lesser General Public License. See
COPYING.LESSER.

This area is reserved for future OpenRTM.

